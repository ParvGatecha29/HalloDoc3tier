@{
    Layout = "_adminDash";
}
@{
    ViewData["Title"] = "Search Records";
}

<section>
    <div class="w-100 p-3 d-flex flex-column align-items-center">
        <div class="row m-4 col-11">
            <p class="col fs-4 fw-bold pb-0 mb-0 d-inline">Search Records</p>
            <div class="col mb-0 text-end">
                <a class="text-decoration-none btn btn-info text-white" id="export">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path transform="scale(-1, 1) translate(-16,0)" d="M6.598 5.013a.144.144 0 0 1 .202.134V6.3a.5.5 0 0 0 .5.5c.667 0 2.013.005 3.3.822.984.624 1.99 1.76 2.595 3.876-1.02-.983-2.185-1.516-3.205-1.799a8.74 8.74 0 0 0-1.921-.306 7.404 7.404 0 0 0-.798.008h-.013l-.005.001h-.001L7.3 9.9l-.05-.498a.5.5 0 0 0-.45.498v1.153c0 .108-.11.176-.202.134L2.614 8.254a.503.503 0 0 0-.042-.028.147.147 0 0 1 0-.252.499.499 0 0 0 .042-.028l3.984-2.933zM7.8 10.386c.068 0 .143.003.223.006.434.02 1.034.086 1.7.271 1.326.368 2.896 1.202 3.94 3.08a.5.5 0 0 0 .933-.305c-.464-3.71-1.886-5.662-3.46-6.66-1.245-.79-2.527-.942-3.336-.971v-.66a1.144 1.144 0 0 0-1.767-.96l-3.994 2.94a1.147 1.147 0 0 0 0 1.946l3.994 2.94a1.144 1.144 0 0 0 1.767-.96v-.667z" />
                        <text x="10" y="18" style="font-size: 5px;fill: white">ALL</text>
                    </svg>
                    Export Data To Excel
                </a>
            </div>
        </div>
        <div class="req_form_container w-100 shadow p-3">
            <div class="row gx-2">
                <div class="col-md-3">
                    <div class="form-floating mb-3">
                        <select class="py-2 form-control form-select w-100" id="RequestStatus">
                            <option value="0" selected>Select Request Status</option>
                            <option value="1">Unassigned</option>
                            <option value="2">Accepted</option>
                            <option value="3">Cancelled</option>
                            <option value="4">MDEnRoute</option>
                            <option value="5">MDONSite</option>
                            <option value="6">Conclude</option>
                            <option value="7">CancelledByPatient</option>
                            <option value="8">Closed</option>
                            <option value="9">UnPaid</option>
                            <option value="10">Clear</option>
                            <option value="11">Blocked</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="PatientName" placeholder="Patient Name">
                        <label for="PatientName">Patient Name</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating mb-3">
                        <select class="py-2 form-control form-select w-100" id="RequestType">
                            <option value="0" selected>Select Request Type</option>
                            <option value="1">Business</option>
                            <option value="2">Patient</option>
                            <option value="3">Family</option>
                            <option value="4">Concierge</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating mb-3">
                        <input type="date" id='FromDoS' class="form-control" placeholder="From Date of Service">
                        <label for="FromDoS">From Date of Service</label>
                    </div>
                </div>
            </div>
            <div class="row gx-2">
                <div class="col-md-3">
                    <div class="form-floating mb-3">
                        <input type="date" class="form-control" id="ToDoS" placeholder="To Date of Service">
                        <label for="ToDoS">To Date of Service</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="ProviderName" placeholder="Provider Name">
                        <label for="ProviderName">Provider Name</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="Email" placeholder="Email">
                        <label for="email">Email</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating h-100">
                        <input type="tel" id='Phone' class="form-control h-100" placeholder="Phone Number">
                        @* <label for="phone">Phone Number</label> *@
                    </div>
                </div>
            </div>
            <div class="d-flex flex-row-reverse">
                <button id="SearchFilter" class="btn btn-info text-white mx-1">Search</button>
                <button id="ClearFilter" class="btn btn_hover btn-outline-info mx-1">Clear</button>
            </div>
            <div id="SearchRecords" class="table-responsive">
            </div>
        </div>
    </div>
    <div class="modal fade" id="DeleteConfirmationModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-info">
                    <h1 class="modal-title text-light  fs-5" id="exampleModalLabel">Confirm Delete</h1>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure want to delete??</p>
                    <div class="modal-footer">
                        <input id="DelRequestId" type="text" class="d-none" />
                        <button id="DeleteSuccess" type="button" class="btn btn-info text-light">Confirm</button>
                        <button type="button" class="btn btn_hover btn-outline-info" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
   
   document.getElementById("records-tab").classList.add("active");;

    $(document).ready(function () {

        $("#DeleteSuccess").on("click", function () {
            var requestid = $("#DelRequestId").val();
            deletePatientRequest(requestid);
        });

        $("#SearchFilter").on("click", function () {
            var email = $("#Email").val();
            var fromdos = $("#FromDoS").val();
            var phone = $("#Phone").val();
            var todos = $("#ToDoS").val();
            var patient = $("#PatientName").val().toLowerCase();
            var provider = $("#ProviderName").val().toLowerCase();
            var status = $("#RequestStatus").val();
            var type = $("#RequestType").val();

            if (!email && !fromdos && !phone && !todos && !patient && !provider && status == 0 && type == 0) {
            } else {
                fetchSearchRecords(email, fromdos, phone, todos, patient, provider, status, type);
            }
        });

        $("#ClearFilter").on("click", function () {
            clearFiltersAndFetchRecords();
        });

        fetchSearchRecords("", "", "", "", "", "", 0, 0);
    });

    function deleterequest(RequestId) {
        $("#DelRequestId").val(RequestId);
        $("#DeleteConfirmationModal").modal('show');
    }
    function deletePatientRequest(requestid) {
        $.ajax({
            method: "POST",
            url: "/AdminDashboard/DeletePatientRequest",
            data: { requestid: requestid },
            success: function (response) {
                if (response.code == 401) {
                    location.reload();
                } else {
                    if (response.success == true) {
                        $("#DeleteConfirmationModal").modal('hide');
                        Swal.fire({
                            title: "Done",
                            text: "Request Deleted",
                            icon: "success",
                            showConfirmButton: false,
                            timer: 1500
                        })
                        fetchSearchRecords();
                    } else {
                        Swal.fire({
                            title: "Oops...",
                            text: "Failed to delete request",
                            icon: "error",
                            showConfirmButton: false,
                            timer: 1500
                        })
                    }
                }
            },
            error: function () {
            }
        });
    }

    function fetchSearchRecords(email, fromdos, phone, todos, patient, provider, status, type) {
        $.ajax({
            method: "GET",
            url: "/AdminDashboard/GetSearchRecords",
            data: {
                Email: email,
                FromDoS: fromdos,
                Phone: phone,
                Patient: patient,
                Provider: provider,
                RequestStatus: status,
                RequestType: type,
                ToDoS: todos
            },
            success: function (response) {
                if (response.code == 401) {
                    location.reload();
                } else {
                    $('#SearchRecords').html(response);
                    var windowsize = $(window).width();
                    // if (windowsize > 766) {
                    //     setupPagination(10, '.data-row');
                    // }
                    // else {
                    //     setupPagination(10, '.data-mobile-row');
                    // }
                }
            }
        });
    }

    function clearFiltersAndFetchRecords() {
        $("#Email, #Phone, #PatientName, #ProviderName").val("");
        $("#FromDoS, #ToDoS").val("");
        $("#RequestStatus, #RequestType").val(0);
        fetchSearchRecords("", "", "", "", "", "", 0, 0);
    }

    function changepage(pageNumber) {
        $.ajax({
            url: '@Url.Action("ChangePageSearch", "AdminDashboard")',
            data: { pageNumber: pageNumber },
            success: function () {
                fetchSearchRecords();
            }
        });
    }

    $("#export").click(function () {
        var email = $("#Email").val();
        var fromdos = $("#FromDoS").val();
        var phone = $("#Phone").val();
        var todos = $("#ToDoS").val();
        var patient = $("#PatientName").val().toLowerCase();
        var provider = $("#ProviderName").val().toLowerCase();
        var status = $("#RequestStatus").val();
        var type = $("#RequestType").val();
        window.location.href = "/AdminDashboard/ExportRecords?Email=" + email + "&FromDoS=" + fromdos + "&Phone=" + phone + "&Patient=" + patient + "&Provider=" + provider + "&RequestStatus=" + status + "&RequestType=" + type;

    })
</script>